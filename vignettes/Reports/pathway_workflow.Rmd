---
title: "Pathway Workflow"
output: html_document
params:
  pre_processed:
  deg:
  idep_data:
  converted:
  all_gene_names:
  go:
  select_org:
  my_range:
  select_contrast:
  min_set_size:
  max_set_size:
  limma:
  gene_p_val_cutoff:
  gene_sets:
  absolute_fold:
  pathway_p_val_cutoff:
  n_pathway_show:
  contrast_samples:
  sig_pathways:
  #heatmap_color_select:
  pathway_method:
  gage_pathway_data:
  selected_pathway_data:
  pathway_list_data:
  network_data:
  # fgsea_pathway_data:
  # pgsea_plot_data:
  # pgsea_plot_all_samples_data:
  # gene_info:
  date:
    label: "Date: "
    value: !r Sys.Date()
  printcode:
    label: "Display Code"
    value: TRUE
    input: checkbox
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = params$printcode)
```

<!-- This document cannot be knit directly from R studio -->

This html document contains what parameters values were selected on the IDEP interface. It also includes the plots generated from those selections. Genes with FDR Greater than **`r params$gene_p_val_cutoff`** were removed. **`r n_pathway_show`** pathways with between **`r params$min_set_size`** and **`r params$max_set_size`** were included. Absolute fold values were `r `ifelse(params$absolute_fold`, "not", "")` used. Pathways were found using **switch(as.character(params$pathway_method),
"1" = "GAGE",
"2" = "PGSEA",
"3" = "GSEA (Pre-Ranked)",
"4" = "PGSEA with all samples",
"5" = "ReactomePA",

)**.

```{r}
#params$gage_pathway_data
```

# Summary

<!--ALL SELECTED PARAMETERS-->

```{r echo=TRUE}
for (i in 1:length(params)){
  # exclude loaded data & sample info
  if(names(params)[i] != "sample_info" && names(params)[i] != "loaded_data" && names(params)[i] != "pre_processed" && names(params)[i] != "deg" && names(params)[i] != "idep_data" && names(params)[i] != "converted" && names(params)[i] != "limma" && names(params)[i] != "gene_sets" && names(params)[i] != "selected_pathway_data" && names(params)[i] != "pathway_list_data" && names(params)[i] != "all_gene_names" )
    cat(paste0(names(params)[i], ": ", params[[i]], "\n")
   )
}
```

```{r}

```

```{r echo=TRUE}

# GAGE Method
if (params$pathway_method == 1){
gene_sets <- read_gene_sets(
  converted = params$converted,
  all_gene_names = params$all_gene_names,
  go = params$go,
  select_org = params$select_org,
  idep_data = params$idep_data,
  my_range = params$my_range
)

gage <- gage_data(
  select_go = params$go,
  select_contrast = params$select_contrast,
  min_set_size = params$min_set_size,
  max_set_size = params$max_set_size,
  limma = params$limma,
  gene_p_val_cutoff = params$gene_p_val_cutoff,
  gene_sets = params$gene_sets,
  absolute_fold = params$absolute_fold,
  pathway_p_val_cutoff = params$pathway_p_val_cutoff,
  n_pathway_show = params$n_pathway_show
)

basic_heatmap(
  data = params$selected_pathway_data,
  c("green", "black", "red")
)

# enrichment_plot(
#   go_table = params$pathway_list_data#,
#   #45
# )

vis_network_plot(
    network_data = params$network_data
)


basic_heatmap(
  data = params$selected_pathway_data,
  c("green", "black", "red")
)

enrichment_tree_plot(
  go_table = params$pathway_list_data,
  group = "All Groups"
  #45
)
}


```

```{r}
# PGSEA
if (params$pathway_method == 2) {
  return("Plot to be added")
}
```
